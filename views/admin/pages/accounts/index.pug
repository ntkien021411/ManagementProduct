extends ../../layouts/default.pug
include ../../mixins/pagination.pug
include ../../mixins/alert.pug

block main
    +alertError(5000)
    +alertSuccess(5000)
    if(role.permissions.includes("accounts_view"))
      h1 Danh sách tài khoản

      .card.mb-3 
        .card-header Danh sách
        .card-body
          .row 
            .col-8 
              
            .col-4.text-right
              if(role.permissions.includes("accounts_create"))
                a(
                  href=`${prefixAdmin}/accounts/create`
                  class = "btn btn-outline-success mb-3"
                ) + Thêm mới

          table(class="table table-hover table-sm"
                checkbox-multi) 
            thead
              tr
                
                th STT
                th Avatar
                th Họ tên
                th Phân quyền
                th Email
                th Trạng thái
                th Hành động
            tbody 
              each item,index in records
                tr
                  td #{pagination.limitItem * (pagination.currentPage - 1) + (index+1)}
                  td 
                    img(
                    src=item.avatar,
                    alt=item.fullName,
                      width = "100px",
                    height = "auto"
                    )
                  td #{item.fullName}
                  td #{item.role ? item.role.title : "Chưa phân quyền" }
                  td #{item.email}
                  td
                    if(role.permissions.includes("accounts_view")) 
                      if(item.status =="active")
                        a(href="javascript:;"
                        button-change-status 
                        data-status=item.status
                        data-id=item.id class="badge badge-success") Hoạt động
                      else 
                        a(href="javascript:;"
                        button-change-status 
                        data-status=item.status
                        data-id=item.id class="badge badge-danger") Dừng hoạt động
                    else
                      if(item.status =="active")
                        button( class="badge badge-success") Hoạt động
                      else 
                        button( class="badge badge-danger") Dừng hoạt động

                  td
                    
                    a(href=`${prefixAdmin}/accounts/detail/${item.id}`
                      class="btn btn-secondary btn-sm") Chi tiết 
                    if(role.permissions.includes("accounts_edit")) 
                      a(href=`${prefixAdmin}/accounts/edit/${item.id}`
                        class="btn btn-warning btn-sm") Sửa
                    if(role.permissions.includes("accounts_delete")) 
                      button(class="btn btn-danger btn-sm ml-1"
                        button-delete
                        data-id=item.id) Xóa
      
      +pagination(pagination)
    if(role.permissions.includes("accounts_edit"))    
      form(action="" 
            method="POST"
            id="form-change-status"
            data-path=`${prefixAdmin}/accounts/change-status`)
    if(role.permissions.includes("accounts_delete"))        
      form(action="" 
            method="POST"
            id="form-delete-item"
            data-path=`${prefixAdmin}/accounts/delete`)
    else 
      h1 Bạn không có quyền trong trang này!